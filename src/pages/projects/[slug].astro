---
import Layout from "../../layouts/Layout.astro";
import "../../style/nav_footer.css";
import "../../style/index_style.css";
import "../../style/projects_page.css";
import "../../style/slug.css"
import { turso, rowsToObject } from "../../scripts/db.js";

// Extract id and itemType from the current URL
const path = Astro.url.pathname;
const parts = path.split("/");
const segments = parts[2].split("-");
const id = Number(segments[segments.length - 1]);
const itemType = segments[segments.length - 2];

var title = "";
var properties;

// Select the right item properties based on itemType via database
switch (itemType){
	case "plants":
		[properties] = rowsToObject(await turso.execute('SELECT * FROM plant JOIN plantSpecies ON plantSpecies.id = plant.speciesID WHERE plant.id = ?', [id]));
		break;
	case "animals":
		[properties] = rowsToObject(await turso.execute('SELECT * FROM animal JOIN animalSpecies ON animalSpecies.id = animal.speciesID WHERE animal.id = ?', [id]));
		break;
	case "myprojects":
		[properties] = rowsToObject(await turso.execute('SELECT * FROM project WHERE project.id = ?', [id]));
		break;
	case "equipment":
		[properties] = rowsToObject(await turso.execute('SELECT * FROM equipment JOIN equipmentType ON equipmentType.id = equipment.typeID WHERE equipment.id = ?', [id]));
		break;
	default:
		// Throw error if itemType is invalid
		throw new Error("Invalid item type: " + itemType);
}

// Set the page title from the item's name
title = properties.name;
---

<Layout title={title}>
	<main>
		<div class="popup">	
			<h1 class="project-title">{title}</h1>
			<div class="container_all">
				<div class="pic_property_container">
					<div class="property_container">
						<!-- Render all properties except notes and picturePath -->
						{Object.entries(properties).filter(([key]) => key !== "notes" && key !== "picturePath").map(([key, value]) => {
							return(
								<div class="property">
									<div class="property_key">{key}</div>
									<div class="property_value">{value}</div>
								</div>
							)
						})}
					</div>
					<div class="pic_container">
						<!-- Show default image if picturePath is "N/A" -->
						<img src={properties.picturePath == "N/A"? "/images/plants/Monstera Deliciosa.png":properties.picturePath}>
						<div class="placeholder"></div>
					</div>
				</div>
				<div class="property_notes">
					<div class="property_notes_key">Notes:</div>
					<div class="property_notes_value">{properties.notes}</div>
				</div>
			</div>
		</div>
	</main>
</Layout>