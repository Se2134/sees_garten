---
import Layout from "../../layouts/Layout.astro";
import "../../style/nav_footer.css";
import "../../style/index_style.css";
import "../../style/projects_page.css";
import "../../style/slug.css"

import {db, Plants, MyProjects, Animals, Equipment, eq} from 'astro:db';

const path = Astro.url.pathname;
const parts = path.split("/");
const segments = parts[2].split("-");

const id = Number(segments[segments.length - 1]);
const itemType = segments[segments.length - 2];

var title = "";
var properties;

switch (itemType){
	case "plants":
		[properties] = await db.select().from(Plants).where(eq(Plants.idplants, id));
		break;
	case "projects":
		[properties] = await db.select().from(MyProjects).where(eq(MyProjects.idprojects, id));
		break;
	case "animals":
		[properties] = await db.select().from(Animals).where(eq(Animals.idanimals, id));
		break;
	case "equipment":
		[properties] = await db.select().from(Equipment).where(eq(Equipment.idequipment, id));
		break;
	default:
		throw new Error("Invalid item type: " + itemType);
}

title = properties.name;
---

<Layout title={title}>
	<main>
		<div class="popup">	
			<h1 class="project-title">{title}</h1>
			<div class="container_all">
				<div class="pic_property_container">
					<div class="property_container">
						{Object.entries(properties).filter(([key]) => key !== "notes" && key !== "picturePath").map(([key, value]) => {
							return(
								
								<div class="property">
									<div class="property_key">{key}</div>
									<div class="property_value">{value instanceof Date? value.toDateString():value}</div>
								</div>
								)
							}
						)}
					</div>
					<div class="pic_container">
						<img src={properties.picturePath == "N/A"? "/src/images/plants/Monstera Deliciosa.png":properties.picturePath}>
						<div class="placeholder"></div>
					</div>
				</div>
				<div class="property_notes">
					<div class="property_notes_key">Notes:</div>
					<div class="property_notes_value">{properties.notes}</div>
				</div>
			</div>
		</div>
	</main>
</Layout>